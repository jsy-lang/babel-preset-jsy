#!/usr/bin/env node
'use strict';

const babel_preset_jsy_json = require('../../package.json');
const fs = require('fs');

const argv = process.argv.slice(2);

let jsy_mode = 'jsy';
let jsy_options;
const jsy_option_sets = { no_stage_3: { no_stage_3: true }, all: { stage_3: true,
    targets: { node: true, browser: true }, offside: { check_blocks: '\/node_modules\/|\\node_modules\\/' } } };

if (argv.includes('--help')) {
  console.log(['', '  Usage: jsy-init [options]', '', '  Purpose: Configures the package.json with Babel settings, devDependencies, and common scripts for quickly starting a new project.', '', '  Options:', '', '    --help            output usage information', '    --lite            lean and use new `babel-plugin-jsy-lite` transpiler', '    --lean            add concise babel config option to exclude stage_3 preset (used to prevent async/await code generation)', '    --no_stage_3      add babel config option to exclude stage_3 preset (used to prevent async/await code generation)', '    --options         add all babel config options for JSY for later editing', ''].join('\n'));
} else {
  if (argv.includes('--lite')) {
    jsy_mode = 'jsy/lite';
  } else if (argv.includes('--lean')) {
    jsy_mode = 'jsy/lean';
  }

  if (argv.includes('--no_stage_3' || argv.includes('--no_stage3'))) {
    jsy_options = Object.assign({}, jsy_options, jsy_option_sets.no_stage_3);
  }

  if (argv.includes('--options')) {
    jsy_options = Object.assign({}, jsy_options, jsy_option_sets.all);
  }

  transformPackageJson();
}

function transformPackageJson(filename = './package.json') {
  new Promise((resolve, reject) => fs.readFile(filename, 'utf-8', (err, content) => err ? reject(err) : resolve(content))).then(content => JSON.parse(content)).then(pkg => {
    console.log(['', `Merging settings into "${filename}":`, JSON.stringify(setupPackageJson({}), null, 2), ''].join('\n'));
    return setupPackageJson(pkg);
  }).then(pkg => JSON.stringify(pkg, null, 2)).then(content => new Promise((resolve, reject) => fs.writeFile(filename, content, err => err ? reject(err) : resolve(content)))).then(content => console.log(`Wrote merged JSY settings into "${filename}"`));
}

function setupPackageJson(pkg) {
  pkg.devDependencies = setupDevDependencies(pkg.devDependencies || {});
  pkg.babel = setupBabelPresets(pkg.babel || {});
  pkg.scripts = setupScripts(pkg.scripts || {});
  return pkg;
}

function setupDevDependencies(devDependencies) {
  devDependencies['babel-cli'] = babel_preset_jsy_json.devDependencies['babel-cli'];
  devDependencies['babel-preset-jsy'] = `^${babel_preset_jsy_json.version}`;
  devDependencies['nodemon'] = '*';
  return devDependencies;
}

const existing_jsy_modes = new Set(['jsy', 'jsy/lean', 'jsy/lite']);

function setupBabelPresets(babel) {
  if (!babel.presets) {
    babel.presets = [];
  } else if ('string' === babel.presets) {
    babel.presets = [babel.presets];
  }

  if (babel.presets.find(e => existing_jsy_modes.has(e) || existing_jsy_modes.has(e[0]))) {
    console.log('Existing JSY settings found. Please edit Babel settings manually');
  } else {
    babel.presets.push(jsy_options ? [jsy_mode, jsy_options] : jsy_mode);
  }

  return babel;
}

function setupScripts(scripts) {
  if (!scripts.start) {
    scripts.start = 'node dist';
  }

  if (!scripts['start:dev']) {
    scripts['start:dev'] = 'nodemon -d 2 dist';
  }

  if (!scripts.build) {
    scripts.build = 'babel -s inline -x .js,.jsy code -d dist';
  }

  if (!scripts.watch) {
    scripts.watch = 'npm -s run build -- --watch';
  }

  if (!scripts.pretest) {
    scripts.pretest = 'npm -s run build';
  }

  if (!scripts.testone) {
    scripts.testone = 'babel-node test/example.jsy';
  }

  return scripts;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2NvZGUvYmluL2pzeS1pbml0LmpzIl0sIm5hbWVzIjpbImJhYmVsX3ByZXNldF9qc3lfanNvbiIsInJlcXVpcmUiLCJmcyIsImFyZ3YiLCJwcm9jZXNzIiwic2xpY2UiLCJqc3lfbW9kZSIsImpzeV9vcHRpb25zIiwianN5X29wdGlvbl9zZXRzIiwibm9fc3RhZ2VfMyIsImFsbCIsInN0YWdlXzMiLCJ0YXJnZXRzIiwibm9kZSIsImJyb3dzZXIiLCJvZmZzaWRlIiwiY2hlY2tfYmxvY2tzIiwiaW5jbHVkZXMiLCJjb25zb2xlIiwibG9nIiwiam9pbiIsIk9iamVjdCIsImFzc2lnbiIsInRyYW5zZm9ybVBhY2thZ2VKc29uIiwiZmlsZW5hbWUiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsInJlYWRGaWxlIiwiZXJyIiwiY29udGVudCIsInRoZW4iLCJKU09OIiwicGFyc2UiLCJwa2ciLCJzdHJpbmdpZnkiLCJzZXR1cFBhY2thZ2VKc29uIiwid3JpdGVGaWxlIiwiZGV2RGVwZW5kZW5jaWVzIiwic2V0dXBEZXZEZXBlbmRlbmNpZXMiLCJiYWJlbCIsInNldHVwQmFiZWxQcmVzZXRzIiwic2NyaXB0cyIsInNldHVwU2NyaXB0cyIsInZlcnNpb24iLCJleGlzdGluZ19qc3lfbW9kZXMiLCJTZXQiLCJwcmVzZXRzIiwiZmluZCIsImUiLCJoYXMiLCJwdXNoIiwic3RhcnQiLCJidWlsZCIsIndhdGNoIiwicHJldGVzdCIsInRlc3RvbmUiXSwibWFwcGluZ3MiOiI7O0FBQ0EsTUFBTUEsd0JBQXdCQyxRQUFRLG9CQUFSLENBQTlCO0FBQ0EsTUFBTUMsS0FBS0QsUUFBUSxJQUFSLENBQVg7O0FBRUEsTUFBTUUsT0FBT0MsUUFBUUQsSUFBUixDQUFhRSxLQUFiLENBQW1CLENBQW5CLENBQWI7O0FBRUEsSUFBSUMsV0FBUyxLQUFiO0FBQ0EsSUFBSUMsV0FBSjtBQUNBLE1BQU1DLGtCQUNKLEVBQUlDLFlBQ0UsRUFBSUEsWUFBWSxJQUFoQixFQURO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RyxDQUFDQSxRQUFRVSxLQUFaLEVBQW9CO0FBQ2xCVixZQUFRVSxLQUFSLEdBQWdCLFdBQWhCO0FBQTJCOztBQUU3QixNQUFHLENBQUNWLFFBQVEsV0FBUixDQUFKLEVBQTJCO0FBQ3pCQSxZQUFRLFdBQVIsSUFBdUIsbUJBQXZCO0FBQTBDOztBQUU1QyxNQUFHLENBQUNBLFFBQVFXLEtBQVosRUFBb0I7QUFDbEJYLFlBQVFXLEtBQVIsR0FBZ0IsMENBQWhCO0FBQTBEOztBQUU1RCxNQUFHLENBQUNYLFFBQVFZLEtBQVosRUFBb0I7QUFDbEJaLFlBQVFZLEtBQVIsR0FBZ0IsNkJBQWhCO0FBQTZDOztBQUUvQyxNQUFHLENBQUNaLFFBQVFhLE9BQVosRUFBc0I7QUFDcEJiLFlBQVFhLE9BQVIsR0FBa0Isa0JBQWxCO0FBQW9DOztBQUV0QyxNQUFHLENBQUNiLFFBQVFjLE9BQVosRUFBc0I7QUFDcEJkLFlBQVFjLE9BQVIsR0FBa0IsNkJBQWxCO0FBQStDOztBQUVqRCxTQUFPZCxPQUFQO0FBQWMiLCJmaWxlIjoianN5LWluaXQuanMiLCJzb3VyY2VzQ29udGVudCI6WyJcbmNvbnN0IGJhYmVsX3ByZXNldF9qc3lfanNvbiA9IHJlcXVpcmUoJy4uLy4uL3BhY2thZ2UuanNvbicpXG5jb25zdCBmcyA9IHJlcXVpcmUoJ2ZzJylcblxuY29uc3QgYXJndiA9IHByb2Nlc3MuYXJndi5zbGljZSgyKVxuXG5sZXQganN5X21vZGU9J2pzeSdcbmxldCBqc3lfb3B0aW9uc1xuY29uc3QganN5X29wdGlvbl9zZXRzID1cbiAgQHt9IG5vX3N0YWdlXzM6XG4gICAgICAgIEB7fSBub19zdGFnZV8zOiB0cnVlXG4gICAgLCBhbGw6XG4gICAgICAgIEB7fSBzdGFnZV8zOiB0cnVlXG4gICAgICAgICAgLCB0YXJnZXRzOiBAe30gbm9kZTogdHJ1ZSwgYnJvd3NlcjogdHJ1ZVxuICAgICAgICAgICwgb2Zmc2lkZTogQHt9IGNoZWNrX2Jsb2NrczogJ1xcL25vZGVfbW9kdWxlc1xcL3xcXFxcbm9kZV9tb2R1bGVzXFxcXC8nXG5cbmlmIGFyZ3YuaW5jbHVkZXMgQCAnLS1oZWxwJyA6OlxuICBjb25zb2xlLmxvZyBAXG4gICAgQFtdICcnXG4gICAgICAsICcgIFVzYWdlOiBqc3ktaW5pdCBbb3B0aW9uc10nXG4gICAgICAsICcnXG4gICAgICAsICcgIFB1cnBvc2U6IENvbmZpZ3VyZXMgdGhlIHBhY2thZ2UuanNvbiB3aXRoIEJhYmVsIHNldHRpbmdzLCBkZXZEZXBlbmRlbmNpZXMsIGFuZCBjb21tb24gc2NyaXB0cyBmb3IgcXVpY2tseSBzdGFydGluZyBhIG5ldyBwcm9qZWN0LidcbiAgICAgICwgJydcbiAgICAgICwgJyAgT3B0aW9uczonXG4gICAgICAsICcnXG4gICAgICAsICcgICAgLS1oZWxwICAgICAgICAgICAgb3V0cHV0IHVzYWdlIGluZm9ybWF0aW9uJ1xuICAgICAgLCAnICAgIC0tbGl0ZSAgICAgICAgICAgIGxlYW4gYW5kIHVzZSBuZXcgYGJhYmVsLXBsdWdpbi1qc3ktbGl0ZWAgdHJhbnNwaWxlcidcbiAgICAgICwgJyAgICAtLWxlYW4gICAgICAgICAgICBhZGQgY29uY2lzZSBiYWJlbCBjb25maWcgb3B0aW9uIHRvIGV4Y2x1ZGUgc3RhZ2VfMyBwcmVzZXQgKHVzZWQgdG8gcHJldmVudCBhc3luYy9hd2FpdCBjb2RlIGdlbmVyYXRpb24pJ1xuICAgICAgLCAnICAgIC0tbm9fc3RhZ2VfMyAgICAgIGFkZCBiYWJlbCBjb25maWcgb3B0aW9uIHRvIGV4Y2x1ZGUgc3RhZ2VfMyBwcmVzZXQgKHVzZWQgdG8gcHJldmVudCBhc3luYy9hd2FpdCBjb2RlIGdlbmVyYXRpb24pJ1xuICAgICAgLCAnICAgIC0tb3B0aW9ucyAgICAgICAgIGFkZCBhbGwgYmFiZWwgY29uZmlnIG9wdGlvbnMgZm9yIEpTWSBmb3IgbGF0ZXIgZWRpdGluZydcbiAgICAgICwgJydcbiAgICAuam9pbignXFxuJylcblxuZWxzZSA6OlxuICBpZiBhcmd2LmluY2x1ZGVzIEAgJy0tbGl0ZScgOjpcbiAgICBqc3lfbW9kZSA9ICdqc3kvbGl0ZSdcblxuICBlbHNlIGlmIGFyZ3YuaW5jbHVkZXMgQCAnLS1sZWFuJyA6OlxuICAgIGpzeV9tb2RlID0gJ2pzeS9sZWFuJ1xuXG4gIGlmIGFyZ3YuaW5jbHVkZXMgQCAnLS1ub19zdGFnZV8zJyB8fCBhcmd2LmluY2x1ZGVzIEAgJy0tbm9fc3RhZ2UzJyA6OlxuICAgIGpzeV9vcHRpb25zID0gT2JqZWN0LmFzc2lnbiBAIHt9LCBqc3lfb3B0aW9ucywganN5X29wdGlvbl9zZXRzLm5vX3N0YWdlXzNcblxuICBpZiBhcmd2LmluY2x1ZGVzIEAgJy0tb3B0aW9ucycgOjpcbiAgICBqc3lfb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24gQCB7fSwganN5X29wdGlvbnMsIGpzeV9vcHRpb25fc2V0cy5hbGxcblxuICB0cmFuc2Zvcm1QYWNrYWdlSnNvbigpXG5cblxuZnVuY3Rpb24gdHJhbnNmb3JtUGFja2FnZUpzb24oZmlsZW5hbWU9Jy4vcGFja2FnZS5qc29uJykgOjpcbiAgbmV3IFByb21pc2UgQCAocmVzb2x2ZSwgcmVqZWN0KSA9PlxuICAgIGZzLnJlYWRGaWxlIEAgZmlsZW5hbWUsICd1dGYtOCcsXG4gICAgICAoZXJyLCBjb250ZW50KSA9PiBlcnIgPyByZWplY3QoZXJyKSA6IHJlc29sdmUoY29udGVudClcblxuICAudGhlbiBAIGNvbnRlbnQgPT4gSlNPTi5wYXJzZSBAIGNvbnRlbnRcblxuICAudGhlbiBAIHBrZyA9PiA6OlxuICAgIGNvbnNvbGUubG9nIEBcbiAgICAgIEBbXSAnJywgYE1lcmdpbmcgc2V0dGluZ3MgaW50byBcIiR7ZmlsZW5hbWV9XCI6YFxuICAgICAgICAsIEpTT04uc3RyaW5naWZ5IEAgc2V0dXBQYWNrYWdlSnNvbih7fSksIG51bGwsIDJcbiAgICAgICAgLCAnJ1xuICAgICAgLmpvaW4oJ1xcbicpXG4gICAgcmV0dXJuIHNldHVwUGFja2FnZUpzb24ocGtnKVxuXG4gIC50aGVuIEAgcGtnID0+IEpTT04uc3RyaW5naWZ5KHBrZywgbnVsbCwgMilcblxuICAudGhlbiBAIGNvbnRlbnQgPT5cbiAgICBuZXcgUHJvbWlzZSBAIChyZXNvbHZlLCByZWplY3QpID0+XG4gICAgICBmcy53cml0ZUZpbGUgQCBmaWxlbmFtZSwgY29udGVudCxcbiAgICAgICAgKGVycikgPT4gZXJyID8gcmVqZWN0KGVycikgOiByZXNvbHZlKGNvbnRlbnQpXG5cbiAgLnRoZW4gQCBjb250ZW50ID0+IGNvbnNvbGUubG9nIEAgYFdyb3RlIG1lcmdlZCBKU1kgc2V0dGluZ3MgaW50byBcIiR7ZmlsZW5hbWV9XCJgXG5cblxuZnVuY3Rpb24gc2V0dXBQYWNrYWdlSnNvbihwa2cpIDo6XG4gIHBrZy5kZXZEZXBlbmRlbmNpZXMgPSBzZXR1cERldkRlcGVuZGVuY2llcyBAIHBrZy5kZXZEZXBlbmRlbmNpZXMgfHwge31cbiAgcGtnLmJhYmVsID0gc2V0dXBCYWJlbFByZXNldHMgQCBwa2cuYmFiZWwgfHwge31cbiAgcGtnLnNjcmlwdHMgPSBzZXR1cFNjcmlwdHMgQCBwa2cuc2NyaXB0cyB8fCB7fVxuICByZXR1cm4gcGtnXG5cblxuZnVuY3Rpb24gc2V0dXBEZXZEZXBlbmRlbmNpZXMoZGV2RGVwZW5kZW5jaWVzKSA6OlxuICBkZXZEZXBlbmRlbmNpZXNbJ2JhYmVsLWNsaSddID0gYmFiZWxfcHJlc2V0X2pzeV9qc29uLmRldkRlcGVuZGVuY2llc1snYmFiZWwtY2xpJ11cbiAgZGV2RGVwZW5kZW5jaWVzWydiYWJlbC1wcmVzZXQtanN5J10gPSBgXiR7YmFiZWxfcHJlc2V0X2pzeV9qc29uLnZlcnNpb259YFxuICBkZXZEZXBlbmRlbmNpZXNbJ25vZGVtb24nXSA9ICcqJ1xuICByZXR1cm4gZGV2RGVwZW5kZW5jaWVzXG5cblxuY29uc3QgZXhpc3RpbmdfanN5X21vZGVzID0gbmV3IFNldCBAIyAnanN5JywgJ2pzeS9sZWFuJywgJ2pzeS9saXRlJ1xuXG5mdW5jdGlvbiBzZXR1cEJhYmVsUHJlc2V0cyhiYWJlbCkgOjpcbiAgaWYgISBiYWJlbC5wcmVzZXRzIDo6XG4gICAgYmFiZWwucHJlc2V0cyA9IFtdXG4gIGVsc2UgaWYgJ3N0cmluZycgPT09IGJhYmVsLnByZXNldHMgOjpcbiAgICBiYWJlbC5wcmVzZXRzID0gW2JhYmVsLnByZXNldHNdXG5cbiAgaWYgYmFiZWwucHJlc2V0cy5maW5kIEAgZSA9PiBleGlzdGluZ19qc3lfbW9kZXMuaGFzKGUpIHx8IGV4aXN0aW5nX2pzeV9tb2Rlcy5oYXMoZVswXSkgOjpcbiAgICBjb25zb2xlLmxvZyBAICdFeGlzdGluZyBKU1kgc2V0dGluZ3MgZm91bmQuIFBsZWFzZSBlZGl0IEJhYmVsIHNldHRpbmdzIG1hbnVhbGx5J1xuICBlbHNlIDo6XG4gICAgYmFiZWwucHJlc2V0cy5wdXNoIEAganN5X29wdGlvbnMgPyBbanN5X21vZGUsIGpzeV9vcHRpb25zXSA6IGpzeV9tb2RlXG5cbiAgcmV0dXJuIGJhYmVsXG5cbmZ1bmN0aW9uIHNldHVwU2NyaXB0cyhzY3JpcHRzKSA6OlxuICBpZiAhc2NyaXB0cy5zdGFydCA6OlxuICAgIHNjcmlwdHMuc3RhcnQgPSAnbm9kZSBkaXN0J1xuXG4gIGlmICFzY3JpcHRzWydzdGFydDpkZXYnXSA6OlxuICAgIHNjcmlwdHNbJ3N0YXJ0OmRldiddID0gJ25vZGVtb24gLWQgMiBkaXN0J1xuXG4gIGlmICFzY3JpcHRzLmJ1aWxkIDo6XG4gICAgc2NyaXB0cy5idWlsZCA9ICdiYWJlbCAtcyBpbmxpbmUgLXggLmpzLC5qc3kgY29kZSAtZCBkaXN0J1xuXG4gIGlmICFzY3JpcHRzLndhdGNoIDo6XG4gICAgc2NyaXB0cy53YXRjaCA9ICducG0gLXMgcnVuIGJ1aWxkIC0tIC0td2F0Y2gnXG5cbiAgaWYgIXNjcmlwdHMucHJldGVzdCA6OlxuICAgIHNjcmlwdHMucHJldGVzdCA9ICducG0gLXMgcnVuIGJ1aWxkJ1xuXG4gIGlmICFzY3JpcHRzLnRlc3RvbmUgOjpcbiAgICBzY3JpcHRzLnRlc3RvbmUgPSAnYmFiZWwtbm9kZSB0ZXN0L2V4YW1wbGUuanN5J1xuXG4gIHJldHVybiBzY3JpcHRzXG5cbiJdfQ==